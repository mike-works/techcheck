"use strict";var EvaluatorStatus,fs=require("fs"),path=require("path"),os=require("os"),child_process=require("child_process"),extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])};function __extends(e,r){function t(){this.constructor=e}extendStatics(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}function __awaiter(e,r,t,n){return new(t||(t=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new t(function(r){r(e.value)}).then(s,a)}u((n=n.apply(e,r||[])).next())})}function __generator(e,r){var t,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=r.call(e,s)}catch(e){i=[6,e],n=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}!function(e){e[e.Ok=0]="Ok",e[e.Warning=1]="Warning",e[e.Error=2]="Error",e[e.Fail=3]="Fail"}(EvaluatorStatus||(EvaluatorStatus={}));var Evaluator=function(){function e(e){this.config=e.config,this.registry=e.registry,this.env=e.env}return e.prototype.processVerifications=function(){return __awaiter(this,void 0,void 0,function(){var e,r,t=this;return __generator(this,function(n){switch(n.label){case 0:return e=this.config.options.verify,r=0,[4,Promise.all(e.map(function(e){return __awaiter(t,void 0,void 0,function(){var t,n;return __generator(this,function(o){switch(o.label){case 0:if(r++,t=e.name,null===(n=this.registry.getExtractor(t)))throw new Error('Found item in "root.verify['+r+']" pertaining to unknown extractor: '+t);return[4,n.getInfo(this.env,e)];case 1:return[2,o.sent()]}})})}))];case 1:return[2,n.sent().map(function(e){return{name:e.name,message:e.cmd+" "+e.normalized+" "+(e.match?"is OK    ":"is NOT OK"),found:e.normalized,target:e.target,status:e.match?EvaluatorStatus.Ok:EvaluatorStatus.Fail}})]}})})},e}(),commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function createCommonjsModule(e,r){return e(r={exports:{}},r.exports),r.exports}var es6Promise=createCommonjsModule(function(e,r){e.exports=function(){function e(e){return"function"==typeof e}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},t=0,n=void 0,o=void 0,i=function(e,r){p[t]=e,p[t+1]=r,2===(t+=2)&&(o?o(h):y())},s="undefined"!=typeof window?window:void 0,a=s||{},u=a.MutationObserver||a.WebKitMutationObserver,c="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var e=setTimeout;return function(){return e(h,1)}}var p=new Array(1e3);function h(){for(var e=0;e<t;e+=2){var r=p[e],n=p[e+1];r(n),p[e]=void 0,p[e+1]=void 0}t=0}var v,m,g,d,y=void 0;function w(e,r){var t=this,n=new this.constructor(E);void 0===n[b]&&q(n);var o=t._state;if(o){var s=arguments[o-1];i(function(){return N(o,n,s,t._result)})}else M(t,n,e,r);return n}function _(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var r=new this(E);return P(r,e),r}c?y=function(){return process.nextTick(h)}:u?(m=0,g=new u(h),d=document.createTextNode(""),g.observe(d,{characterData:!0}),y=function(){d.data=m=++m%2}):l?((v=new MessageChannel).port1.onmessage=h,y=function(){return v.port2.postMessage(0)}):y=void 0===s&&"function"==typeof commonjsRequire?function(){try{var e=commonjsRequire,r=e("vertx");return void 0!==(n=r.runOnLoop||r.runOnContext)?function(){n(h)}:f()}catch(e){return f()}}():f();var b=Math.random().toString(36).substring(16);function E(){}var x=void 0,S=1,O=2,j=new $;function R(e){try{return e.then}catch(e){return j.error=e,j}}function k(r,t,n){var o,s,a,u;t.constructor===r.constructor&&n===w&&t.constructor.resolve===_?(a=r,(u=t)._state===S?C(a,u._result):u._state===O?A(a,u._result):M(u,void 0,function(e){return P(a,e)},function(e){return A(a,e)})):n===j?(A(r,j.error),j.error=null):void 0===n?C(r,t):e(n)?(o=t,s=n,i(function(e){var r=!1,t=function(e,r,t,n){try{e.call(r,t,n)}catch(e){return e}}(s,o,function(t){r||(r=!0,o!==t?P(e,t):C(e,t))},function(t){r||(r=!0,A(e,t))},e._label);!r&&t&&(r=!0,A(e,t))},r)):C(r,t)}function P(e,r){var t,n;e===r?A(e,new TypeError("You cannot resolve a promise with itself")):(n=typeof(t=r),null===t||"object"!==n&&"function"!==n?C(e,r):k(e,r,R(r)))}function T(e){e._onerror&&e._onerror(e._result),F(e)}function C(e,r){e._state===x&&(e._result=r,e._state=S,0!==e._subscribers.length&&i(F,e))}function A(e,r){e._state===x&&(e._state=O,e._result=r,i(T,e))}function M(e,r,t,n){var o=e._subscribers,s=o.length;e._onerror=null,o[s]=r,o[s+S]=t,o[s+O]=n,0===s&&e._state&&i(F,e)}function F(e){var r=e._subscribers,t=e._state;if(0!==r.length){for(var n=void 0,o=void 0,i=e._result,s=0;s<r.length;s+=3)n=r[s],o=r[s+t],n?N(t,n,o,i):o(i);e._subscribers.length=0}}function $(){this.error=null}var I=new $;function N(r,t,n,o){var i=e(n),s=void 0,a=void 0,u=void 0,c=void 0;if(i){if((s=function(e,r){try{return e(r)}catch(e){return I.error=e,I}}(n,o))===I?(c=!0,a=s.error,s.error=null):u=!0,t===s)return void A(t,new TypeError("A promises callback cannot return that same promise."))}else s=o,u=!0;t._state!==x||(i&&u?P(t,s):c?A(t,a):r===S?C(t,s):r===O&&A(t,s))}var V=0;function q(e){e[b]=V++,e._state=void 0,e._result=void 0,e._subscribers=[]}var z=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(E),this.promise[b]||q(this.promise),r(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&C(this.promise,this._result))):A(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var r=0;this._state===x&&r<e.length;r++)this._eachEntry(e[r],r)},e.prototype._eachEntry=function(e,r){var t=this._instanceConstructor,n=t.resolve;if(n===_){var o=R(e);if(o===w&&e._state!==x)this._settledAt(e._state,r,e._result);else if("function"!=typeof o)this._remaining--,this._result[r]=e;else if(t===W){var i=new t(E);k(i,e,o),this._willSettleAt(i,r)}else this._willSettleAt(new t(function(r){return r(e)}),r)}else this._willSettleAt(n(e),r)},e.prototype._settledAt=function(e,r,t){var n=this.promise;n._state===x&&(this._remaining--,e===O?A(n,t):this._result[r]=t),0===this._remaining&&C(n,this._result)},e.prototype._willSettleAt=function(e,r){var t=this;M(e,void 0,function(e){return t._settledAt(S,r,e)},function(e){return t._settledAt(O,r,e)})},e}(),W=function(){function e(r){this[b]=V++,this._result=this._state=void 0,this._subscribers=[],E!==r&&("function"!=typeof r&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,r){try{r(function(r){P(e,r)},function(r){A(e,r)})}catch(r){A(e,r)}}(this,r):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var r=this.constructor;return this.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})})},e}();return W.prototype.then=w,W.all=function(e){return new z(this,e).promise},W.race=function(e){var t=this;return r(e)?new t(function(r,n){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(r,n)}):new t(function(e,r){return r(new TypeError("You must pass an array to race."))})},W.resolve=_,W.reject=function(e){var r=new this(E);return A(r,e),r},W._setScheduler=function(e){o=e},W._setAsap=function(e){i=e},W._asap=i,W.polyfill=function(){var e=void 0;if(void 0!==commonjsGlobal)e=commonjsGlobal;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var r=e.Promise;if(r){var t=null;try{t=Object.prototype.toString.call(r.resolve())}catch(e){}if("[object Promise]"===t&&!r.cast)return}e.Promise=W},W.Promise=W,W}()}),auto=es6Promise.polyfill(),matchOperatorsRe=/[|\\{}()[\]^$+*?.]/g,escapeStringRegexp=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(matchOperatorsRe,"\\$&")},ansiStyles=createCommonjsModule(function(e){Object.defineProperty(e,"exports",{enumerable:!0,get:function(){var e={modifiers:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},colors:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39]},bgColors:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49]}};return e.colors.grey=e.colors.gray,Object.keys(e).forEach(function(r){var t=e[r];Object.keys(t).forEach(function(r){var n=t[r];e[r]=t[r]={open:"["+n[0]+"m",close:"["+n[1]+"m"}}),Object.defineProperty(e,r,{value:t,enumerable:!1})}),e}})}),ansiRegex$1=function(){return/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-PRZcf-nqry=><]/g},ansiRegex=ansiRegex$1(),stripAnsi=function(e){return"string"==typeof e?e.replace(ansiRegex,""):e},re=new RegExp(ansiRegex$1().source),hasAnsi=re.test.bind(re),argv=process.argv,terminator=argv.indexOf("--"),hasFlag=function(e){e="--"+e;var r=argv.indexOf(e);return-1!==r&&(-1===terminator||r<terminator)},supportsColor="FORCE_COLOR"in process.env||!(hasFlag("no-color")||hasFlag("no-colors")||hasFlag("color=false"))&&(!!(hasFlag("color")||hasFlag("colors")||hasFlag("color=true")||hasFlag("color=always"))||!(process.stdout&&!process.stdout.isTTY)&&("win32"===process.platform||"COLORTERM"in process.env||"dumb"!==process.env.TERM&&!!/^screen|^xterm|^vt100|color|ansi|cygwin|linux/i.test(process.env.TERM))),defineProps=Object.defineProperties,isSimpleWindowsTerm="win32"===process.platform&&!/^xterm/i.test(process.env.TERM);function Chalk(e){this.enabled=e&&void 0!==e.enabled?e.enabled:supportsColor}isSimpleWindowsTerm&&(ansiStyles.blue.open="[94m");var styles=function(){var e={};return Object.keys(ansiStyles).forEach(function(r){ansiStyles[r].closeRe=new RegExp(escapeStringRegexp(ansiStyles[r].close),"g"),e[r]={get:function(){return build.call(this,this._styles.concat(r))}}}),e}(),proto=defineProps(function(){},styles);function build(e){var r=function(){return applyStyle.apply(r,arguments)};return r._styles=e,r.enabled=this.enabled,r.__proto__=proto,r}function applyStyle(){var e=arguments,r=e.length,t=0!==r&&String(arguments[0]);if(r>1)for(var n=1;n<r;n++)t+=" "+e[n];if(!this.enabled||!t)return t;var o=this._styles,i=o.length,s=ansiStyles.dim.open;for(!isSimpleWindowsTerm||-1===o.indexOf("gray")&&-1===o.indexOf("grey")||(ansiStyles.dim.open="");i--;){var a=ansiStyles[o[i]];t=a.open+t.replace(a.closeRe,a.open)+a.close}return ansiStyles.dim.open=s,t}function init(){var e={};return Object.keys(styles).forEach(function(r){e[r]={get:function(){return build.call(this,[r])}}}),e}defineProps(Chalk.prototype,init());var chalk=new Chalk,styles_1=ansiStyles,hasColor=hasAnsi,stripColor=stripAnsi,supportsColor_1=supportsColor;chalk.styles=styles_1,chalk.hasColor=hasColor,chalk.stripColor=stripColor,chalk.supportsColor=supportsColor_1;var semver=createCommonjsModule(function(e,r){var t;r=e.exports=G,t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},r.SEMVER_SPEC_VERSION="2.0.0";var n=256,o=Number.MAX_SAFE_INTEGER||9007199254740991,i=r.re=[],s=r.src=[],a=0,u=a++;s[u]="0|[1-9]\\d*";var c=a++;s[c]="[0-9]+";var l=a++;s[l]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var f=a++;s[f]="("+s[u]+")\\.("+s[u]+")\\.("+s[u]+")";var p=a++;s[p]="("+s[c]+")\\.("+s[c]+")\\.("+s[c]+")";var h=a++;s[h]="(?:"+s[u]+"|"+s[l]+")";var v=a++;s[v]="(?:"+s[c]+"|"+s[l]+")";var m=a++;s[m]="(?:-("+s[h]+"(?:\\."+s[h]+")*))";var g=a++;s[g]="(?:-?("+s[v]+"(?:\\."+s[v]+")*))";var d=a++;s[d]="[0-9A-Za-z-]+";var y=a++;s[y]="(?:\\+("+s[d]+"(?:\\."+s[d]+")*))";var w=a++,_="v?"+s[f]+s[m]+"?"+s[y]+"?";s[w]="^"+_+"$";var b="[v=\\s]*"+s[p]+s[g]+"?"+s[y]+"?",E=a++;s[E]="^"+b+"$";var x=a++;s[x]="((?:<|>)?=?)";var S=a++;s[S]=s[c]+"|x|X|\\*";var O=a++;s[O]=s[u]+"|x|X|\\*";var j=a++;s[j]="[v=\\s]*("+s[O]+")(?:\\.("+s[O]+")(?:\\.("+s[O]+")(?:"+s[m]+")?"+s[y]+"?)?)?";var R=a++;s[R]="[v=\\s]*("+s[S]+")(?:\\.("+s[S]+")(?:\\.("+s[S]+")(?:"+s[g]+")?"+s[y]+"?)?)?";var k=a++;s[k]="^"+s[x]+"\\s*"+s[j]+"$";var P=a++;s[P]="^"+s[x]+"\\s*"+s[R]+"$";var T=a++;s[T]="(?:~>?)";var C=a++;s[C]="(\\s*)"+s[T]+"\\s+",i[C]=new RegExp(s[C],"g");var A=a++;s[A]="^"+s[T]+s[j]+"$";var M=a++;s[M]="^"+s[T]+s[R]+"$";var F=a++;s[F]="(?:\\^)";var $=a++;s[$]="(\\s*)"+s[F]+"\\s+",i[$]=new RegExp(s[$],"g");var I=a++;s[I]="^"+s[F]+s[j]+"$";var N=a++;s[N]="^"+s[F]+s[R]+"$";var V=a++;s[V]="^"+s[x]+"\\s*("+b+")$|^$";var q=a++;s[q]="^"+s[x]+"\\s*("+_+")$|^$";var z=a++;s[z]="(\\s*)"+s[x]+"\\s*("+b+"|"+s[j]+")",i[z]=new RegExp(s[z],"g");var W=a++;s[W]="^\\s*("+s[j]+")\\s+-\\s+("+s[j]+")\\s*$";var L=a++;s[L]="^\\s*("+s[R]+")\\s+-\\s+("+s[R]+")\\s*$";var U=a++;s[U]="(<|>)?=?\\s*\\*";for(var X=0;X<a;X++)t(X,s[X]),i[X]||(i[X]=new RegExp(s[X]));function D(e,r){if(e instanceof G)return e;if("string"!=typeof e)return null;if(e.length>n)return null;if(!(r?i[E]:i[w]).test(e))return null;try{return new G(e,r)}catch(e){return null}}function G(e,r){if(e instanceof G){if(e.loose===r)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>n)throw new TypeError("version is longer than "+n+" characters");if(!(this instanceof G))return new G(e,r);t("SemVer",e,r),this.loose=r;var s=e.trim().match(r?i[E]:i[w]);if(!s)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var r=+e;if(r>=0&&r<o)return r}return e}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}r.parse=D,r.valid=function(e,r){var t=D(e,r);return t?t.version:null},r.clean=function(e,r){var t=D(e.trim().replace(/^[=v]+/,""),r);return t?t.version:null},r.SemVer=G,G.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},G.prototype.toString=function(){return this.version},G.prototype.compare=function(e){return t("SemVer.compare",this.version,this.loose,e),e instanceof G||(e=new G(e,this.loose)),this.compareMain(e)||this.comparePre(e)},G.prototype.compareMain=function(e){return e instanceof G||(e=new G(e,this.loose)),J(this.major,e.major)||J(this.minor,e.minor)||J(this.patch,e.patch)},G.prototype.comparePre=function(e){if(e instanceof G||(e=new G(e,this.loose)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var r=0;do{var n=this.prerelease[r],o=e.prerelease[r];if(t("prerelease compare",r,n,o),void 0===n&&void 0===o)return 0;if(void 0===o)return 1;if(void 0===n)return-1;if(n!==o)return J(n,o)}while(++r)},G.prototype.inc=function(e,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r),this.inc("pre",r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",r),this.inc("pre",r);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var t=this.prerelease.length;--t>=0;)"number"==typeof this.prerelease[t]&&(this.prerelease[t]++,t=-2);-1===t&&this.prerelease.push(0)}r&&(this.prerelease[0]===r?isNaN(this.prerelease[1])&&(this.prerelease=[r,0]):this.prerelease=[r,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},r.inc=function(e,r,t,n){"string"==typeof t&&(n=t,t=void 0);try{return new G(e,t).inc(r,n).version}catch(e){return null}},r.diff=function(e,r){{if(Q(e,r))return null;var t=D(e),n=D(r);if(t.prerelease.length||n.prerelease.length){for(var o in t)if(("major"===o||"minor"===o||"patch"===o)&&t[o]!==n[o])return"pre"+o;return"prerelease"}for(var o in t)if(("major"===o||"minor"===o||"patch"===o)&&t[o]!==n[o])return o}},r.compareIdentifiers=J;var B=/^[0-9]+$/;function J(e,r){var t=B.test(e),n=B.test(r);return t&&n&&(e=+e,r=+r),t&&!n?-1:n&&!t?1:e<r?-1:e>r?1:0}function Y(e,r,t){return new G(e,t).compare(new G(r,t))}function Z(e,r,t){return Y(e,r,t)>0}function K(e,r,t){return Y(e,r,t)<0}function Q(e,r,t){return 0===Y(e,r,t)}function H(e,r,t){return 0!==Y(e,r,t)}function ee(e,r,t){return Y(e,r,t)>=0}function re(e,r,t){return Y(e,r,t)<=0}function te(e,r,t,n){var o;switch(r){case"===":"object"==typeof e&&(e=e.version),"object"==typeof t&&(t=t.version),o=e===t;break;case"!==":"object"==typeof e&&(e=e.version),"object"==typeof t&&(t=t.version),o=e!==t;break;case"":case"=":case"==":o=Q(e,t,n);break;case"!=":o=H(e,t,n);break;case">":o=Z(e,t,n);break;case">=":o=ee(e,t,n);break;case"<":o=K(e,t,n);break;case"<=":o=re(e,t,n);break;default:throw new TypeError("Invalid operator: "+r)}return o}function ne(e,r){if(e instanceof ne){if(e.loose===r)return e;e=e.value}if(!(this instanceof ne))return new ne(e,r);t("comparator",e,r),this.loose=r,this.parse(e),this.semver===oe?this.value="":this.value=this.operator+this.semver.version,t("comp",this)}r.rcompareIdentifiers=function(e,r){return J(r,e)},r.major=function(e,r){return new G(e,r).major},r.minor=function(e,r){return new G(e,r).minor},r.patch=function(e,r){return new G(e,r).patch},r.compare=Y,r.compareLoose=function(e,r){return Y(e,r,!0)},r.rcompare=function(e,r,t){return Y(r,e,t)},r.sort=function(e,t){return e.sort(function(e,n){return r.compare(e,n,t)})},r.rsort=function(e,t){return e.sort(function(e,n){return r.rcompare(e,n,t)})},r.gt=Z,r.lt=K,r.eq=Q,r.neq=H,r.gte=ee,r.lte=re,r.cmp=te,r.Comparator=ne;var oe={};function ie(e,r){if(e instanceof ie)return e.loose===r?e:new ie(e.raw,r);if(e instanceof ne)return new ie(e.value,r);if(!(this instanceof ie))return new ie(e,r);if(this.loose=r,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function se(e){return!e||"x"===e.toLowerCase()||"*"===e}function ae(e,r,t,n,o,i,s,a,u,c,l,f,p){return((r=se(t)?"":se(n)?">="+t+".0.0":se(o)?">="+t+"."+n+".0":">="+r)+" "+(a=se(u)?"":se(c)?"<"+(+u+1)+".0.0":se(l)?"<"+u+"."+(+c+1)+".0":f?"<="+u+"."+c+"."+l+"-"+f:"<="+a)).trim()}function ue(e,r){for(var n=0;n<e.length;n++)if(!e[n].test(r))return!1;if(r.prerelease.length){for(n=0;n<e.length;n++)if(t(e[n].semver),e[n].semver!==oe&&e[n].semver.prerelease.length>0){var o=e[n].semver;if(o.major===r.major&&o.minor===r.minor&&o.patch===r.patch)return!0}return!1}return!0}function ce(e,r,t){try{r=new ie(r,t)}catch(e){return!1}return r.test(e)}function le(e,r,t,n){var o,i,s,a,u;switch(e=new G(e,n),r=new ie(r,n),t){case">":o=Z,i=re,s=K,a=">",u=">=";break;case"<":o=K,i=ee,s=Z,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ce(e,r,n))return!1;for(var c=0;c<r.set.length;++c){var l=null,f=null;if(r.set[c].forEach(function(e){e.semver===oe&&(e=new ne(">=0.0.0")),l=l||e,f=f||e,o(e.semver,l.semver,n)?l=e:s(e.semver,f.semver,n)&&(f=e)}),l.operator===a||l.operator===u)return!1;if((!f.operator||f.operator===a)&&i(e,f.semver))return!1;if(f.operator===u&&s(e,f.semver))return!1}return!0}ne.prototype.parse=function(e){var r=this.loose?i[V]:i[q],t=e.match(r);if(!t)throw new TypeError("Invalid comparator: "+e);this.operator=t[1],"="===this.operator&&(this.operator=""),t[2]?this.semver=new G(t[2],this.loose):this.semver=oe},ne.prototype.toString=function(){return this.value},ne.prototype.test=function(e){return t("Comparator.test",e,this.loose),this.semver===oe||("string"==typeof e&&(e=new G(e,this.loose)),te(e,this.operator,this.semver,this.loose))},ne.prototype.intersects=function(e,r){if(!(e instanceof ne))throw new TypeError("a Comparator is required");var t;if(""===this.operator)return t=new ie(e.value,r),ce(this.value,t,r);if(""===e.operator)return t=new ie(this.value,r),ce(e.semver,t,r);var n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),o=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),i=this.semver.version===e.semver.version,s=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),a=te(this.semver,"<",e.semver,r)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),u=te(this.semver,">",e.semver,r)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||o||i&&s||a||u},r.Range=ie,ie.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},ie.prototype.toString=function(){return this.range},ie.prototype.parseRange=function(e){var r=this.loose;e=e.trim(),t("range",e,r);var n=r?i[L]:i[W];e=e.replace(n,ae),t("hyphen replace",e),e=e.replace(i[z],"$1$2$3"),t("comparator trim",e,i[z]),e=(e=(e=e.replace(i[C],"$1~")).replace(i[$],"$1^")).split(/\s+/).join(" ");var o=r?i[V]:i[q],s=e.split(" ").map(function(e){return o=r,t("comp",n=e),l=o,n=n.trim().split(/\s+/).map(function(e){return function(e,r){t("caret",e,r);var n=r?i[N]:i[I];return e.replace(n,function(r,n,o,i,s){var a;return t("caret",e,r,n,o,i,s),se(n)?a="":se(o)?a=">="+n+".0.0 <"+(+n+1)+".0.0":se(i)?a="0"===n?">="+n+"."+o+".0 <"+n+"."+(+o+1)+".0":">="+n+"."+o+".0 <"+(+n+1)+".0.0":s?(t("replaceCaret pr",s),"-"!==s.charAt(0)&&(s="-"+s),a="0"===n?"0"===o?">="+n+"."+o+"."+i+s+" <"+n+"."+o+"."+(+i+1):">="+n+"."+o+"."+i+s+" <"+n+"."+(+o+1)+".0":">="+n+"."+o+"."+i+s+" <"+(+n+1)+".0.0"):(t("no pr"),a="0"===n?"0"===o?">="+n+"."+o+"."+i+" <"+n+"."+o+"."+(+i+1):">="+n+"."+o+"."+i+" <"+n+"."+(+o+1)+".0":">="+n+"."+o+"."+i+" <"+(+n+1)+".0.0"),t("caret return",a),a})}(e,l)}).join(" "),t("caret",n),c=o,n=n.trim().split(/\s+/).map(function(e){return r=e,n=c?i[M]:i[A],r.replace(n,function(e,n,o,i,s){var a;return t("tilde",r,e,n,o,i,s),se(n)?a="":se(o)?a=">="+n+".0.0 <"+(+n+1)+".0.0":se(i)?a=">="+n+"."+o+".0 <"+n+"."+(+o+1)+".0":s?(t("replaceTilde pr",s),"-"!==s.charAt(0)&&(s="-"+s),a=">="+n+"."+o+"."+i+s+" <"+n+"."+(+o+1)+".0"):a=">="+n+"."+o+"."+i+" <"+n+"."+(+o+1)+".0",t("tilde return",a),a});var r,n}).join(" "),t("tildes",n),t("replaceXRanges",a=n,u=o),n=a.split(/\s+/).map(function(e){return function(e,r){e=e.trim();var n=r?i[P]:i[k];return e.replace(n,function(r,n,o,i,s,a){t("xRange",e,r,n,o,i,s,a);var u=se(o),c=u||se(i),l=c||se(s),f=l;return"="===n&&f&&(n=""),u?r=">"===n||"<"===n?"<0.0.0":"*":n&&f?(c&&(i=0),l&&(s=0),">"===n?(n=">=",c?(o=+o+1,i=0,s=0):l&&(i=+i+1,s=0)):"<="===n&&(n="<",c?o=+o+1:i=+i+1),r=n+o+"."+i+"."+s):c?r=">="+o+".0.0 <"+(+o+1)+".0.0":l&&(r=">="+o+"."+i+".0 <"+o+"."+(+i+1)+".0"),t("xRange return",r),r})}(e,u)}).join(" "),t("xrange",n),t("replaceStars",s=n,o),n=s.trim().replace(i[U],""),t("stars",n),n;var n,o,s,a,u,c,l}).join(" ").split(/\s+/);return this.loose&&(s=s.filter(function(e){return!!e.match(o)})),s=s.map(function(e){return new ne(e,r)})},ie.prototype.intersects=function(e,r){if(!(e instanceof ie))throw new TypeError("a Range is required");return this.set.some(function(t){return t.every(function(t){return e.set.some(function(e){return e.every(function(e){return t.intersects(e,r)})})})})},r.toComparators=function(e,r){return new ie(e,r).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})},ie.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new G(e,this.loose));for(var r=0;r<this.set.length;r++)if(ue(this.set[r],e))return!0;return!1},r.satisfies=ce,r.maxSatisfying=function(e,r,t){var n=null,o=null;try{var i=new ie(r,t)}catch(e){return null}return e.forEach(function(e){i.test(e)&&(n&&-1!==o.compare(e)||(o=new G(n=e,t)))}),n},r.minSatisfying=function(e,r,t){var n=null,o=null;try{var i=new ie(r,t)}catch(e){return null}return e.forEach(function(e){i.test(e)&&(n&&1!==o.compare(e)||(o=new G(n=e,t)))}),n},r.validRange=function(e,r){try{return new ie(e,r).range||"*"}catch(e){return null}},r.ltr=function(e,r,t){return le(e,r,"<",t)},r.gtr=function(e,r,t){return le(e,r,">",t)},r.outside=le,r.prerelease=function(e,r){var t=D(e,r);return t&&t.prerelease.length?t.prerelease:null},r.intersects=function(e,r,t){return e=new ie(e,t),r=new ie(r,t),e.intersects(r)}}),semver_24=semver.gte,semver_25=semver.lte,semver_30=semver.satisfies,semver_33=semver.validRange;function validateVerifyItem(e,r){if("string"!=typeof e.name)return[{path:"root.verify["+r+"].name",message:"should be a string"}];if(e.version instanceof RegExp)return[];if(e.version instanceof Function)return[];if("string"==typeof e.version)return[];if(e.version instanceof Array)return[{path:"root.verify["+r+"].version",message:"should be an array"}];if(e.version instanceof Object){var t=e.version;return"string"==typeof t.semver?semver_33(t.semver)?[]:[{path:"root.verify["+r+"].version.semver",message:"invalid semver string: "+t.semver}]:e.version.semver&&(e.version.semver.min||e.version.semver.max||e.version.semver.range)?[]:[{path:"root.verify["+r+"].version",message:"invalid object "+JSON.stringify(e.version)}]}return[]}function validateVerifyArray(e){if(!(e instanceof Array))return[{path:"root.verify",message:"should be an array"}];for(var r=0;r<e.length;r++){var t=validateVerifyItem(e[r],r);if(t.length>0)return t}return[]}function validateConfig(e){if(!(e.verify instanceof Object))return[{path:"root",message:"should be an object"}];var r=validateVerifyArray(e.verify);return r.length>0?r:[]}function getIfExists(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return[2,new Promise(function(r,t){fs.exists(e,function(t){r(t?require(e):void 0)})})]})})}function findConfig(e){return void 0===e&&(e=process.cwd()),__awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(t){switch(t.label){case 0:return[4,getIfExists(path.join(e,"techcheck.config.js"))];case 1:return(r=t.sent())?[2,r]:[2,findConfig(path.join(e,".."))]}})})}var Platform,ProjectConfig=function(){function e(){}return Object.defineProperty(e.prototype,"options",{get:function(){if(!this.optionsModule)throw new Error("Attempted to access project config options before it was populated");return this.optionsModule},enumerable:!0,configurable:!0}),e.prototype.setup=function(){return __awaiter(this,void 0,void 0,function(){var e,r;return __generator(this,function(t){switch(t.label){case 0:return[4,findConfig()];case 1:if(e=t.sent(),r=validateConfig(e),this.optionsModule=e,r.length>0)throw new Error(r.map(function(e){return chalk.bgRed.white("Config file format error at "+e.path+", "+e.message)}).join("\n"));return[2]}})})},e}();function indentError(e,r,t){return e+"\n"+r+t.replace(/\n/g,"\n"+r)}!function(e){e[e.Win32=0]="Win32",e[e.Posix=1]="Posix",e[e.Unsupported=2]="Unsupported"}(Platform||(Platform={}));var POSIX_PLATFORMS=["aix","darwin","freebsd","linux","openbsd","cygwin"];function platformFor(e){return"win32"===e?Platform.Win32:POSIX_PLATFORMS.indexOf(e)>=0?Platform.Posix:Platform.Unsupported}function getPlatform(){return platformFor(os.platform())}var Platform$1=Platform;function doesSemverMatch(e,r){var t,n,o="string"!=typeof r?r.range:r;if("string"!=typeof r&&(t=r.min,n=r.max),void 0!==o)return semver_30(e,o);if(void 0!==n)return void 0!==t?semver_24(e,t)&&semver_25(e,n):semver_25(e,n);if(void 0!==t)return semver_24(e,t);throw new Error("Invalid SemVerMatcher object "+JSON.stringify(r))}function doesMatch(e,r){var t=e;return r instanceof RegExp?r.test(t):"string"==typeof r?r===t:r instanceof Function?r(t):doesSemverMatch(t,r.semver)}function validateMatcher(e){return e instanceof RegExp||(e instanceof Function||("string"==typeof e||void 0!==e.semver&&("string"==typeof e.semver&&void 0!==semver_33(e.semver)||"string"!=typeof e.semver&&(void 0!==e.semver.max||void 0!==e.semver.min||void 0!==e.semver.range))))}function isOk(e,r){if(void 0===r||!validateMatcher(r))throw new Error("Invalid matcher: "+JSON.stringify(r));return doesMatch(e,r)}function normalizeValue(e,r){if(void 0===r)return e;if(r instanceof RegExp){var t=r.exec(e);return t&&t.length>0?t[0]:""}return r(e)}var BaseExtractor=function(){function e(e){var r=e.name,t=e.platforms,n=e.normalizerOptions;this.platforms=t,this.name=r,this.normalizerOptions=n}return e.prototype.handlesPlatform=function(e){return this.platforms.indexOf(e)>=0},e.prototype.getInfo=function(r,t){return __awaiter(this,void 0,void 0,function(){var n,o,i,s,a;return __generator(this,function(u){switch(u.label){case 0:if(!this.handlesPlatform(r.platform))throw new Error("Extractor "+this.name+" does not support "+Platform[r.platform]);if(!(n=Object.keys(t).reduce(function(e,r){return"name"===r?e:(e.push(r),e)},[])[0]))throw new Error("Extractor "+this.name+" didn't know which command to execute");return[4,this.getInfoForEnvironment(r,n,t)];case 1:return o=u.sent(),i=e.unbrand(o),s=normalizeValue(i,this.normalizerOptions?this.normalizerOptions.preprocessor:void 0),a=n?t[n]:t,[2,{raw:i,cmd:n,normalized:s,name:this.name,target:a,match:isOk(s,a)}]}})})},e.unbrand=function(e){return e.val},e.brand=function(r){return{val:r,_brand:e.brandStamp}},e}();function runCommand(e){return new Promise(function(r,t){child_process.exec(e,function(e,n,o){null!==e?t(new Error(o)):r(n)})})}var ExecutableExtractor=function(e){function r(r){var t=e.call(this,r)||this;return t.commands=JSON.parse(JSON.stringify(r.commands)),t}return __extends(r,e),r.prototype.getInfoForEnvironment=function(e,r,t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e={},[4,runCommand(this.commands[r])];case 1:return[2,(e.val=t.sent().trim(),e._brand=BaseExtractor.brandStamp,e)]}})})},r}(BaseExtractor),OPENSSL_EXTRACTOR=new ExecutableExtractor({name:"OpenSSL",platforms:[Platform.Win32,Platform.Posix],commands:{version:"openssl version"},normalizerOptions:{preprocessor:/[0-9\.]+/}}),NODE_EXTRACTOR=new ExecutableExtractor({name:"Node.js",platforms:[Platform.Win32,Platform.Posix],commands:{version:"node --version"},normalizerOptions:{preprocessor:/[0-9\.]+/}}),POSTGRES_EXTRACTOR=new ExecutableExtractor({name:"PosgreSQL",platforms:[Platform.Win32,Platform.Posix],commands:{version:"pg_ctl --version"},normalizerOptions:{preprocessor:/[0-9\.]+/}}),ExtractorRegistry=function(){function e(){this.extractors={}}return e.prototype.setup=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){try{this.setupStandardExtractors()}catch(r){throw(e=r).message=indentError("Unable to setup extractor registry","  ",e.message),e}return[2]})})},e.prototype.setupStandardExtractors=function(){this.extractors.openssl=OPENSSL_EXTRACTOR,this.extractors.node=NODE_EXTRACTOR,this.extractors.postgres=POSTGRES_EXTRACTOR},e.prototype.getExtractor=function(e){return this.extractors[e]||null},e}(),DEFAULT_ENVIRONMENT_OPTIONS={platform:getPlatform()},Environment=function(){return function(e){if(void 0===e&&(e={}),this.options={platform:void 0===e.platform?DEFAULT_ENVIRONMENT_OPTIONS.platform:e.platform},this.options.platform===Platform$1.Unsupported)throw new Error("Unsupported platform: "+Platform$1[this.options.platform]);this.platform=this.options.platform}}();function successMessage(e,r){var t="  ✅  "+r.name+"\t"+r.message;t+=chalk.grey("\t(required: "+formatMatcher(r.target)+" )"),e.write(t+"\n")}function failMessage(e,r){var t="  🛑  "+r.name+"\t"+r.message;t+=chalk.grey("\t(required: "+formatMatcher(r.target)+" )"),e.write(t+"\n")}function warnMessage(e,r){e.write("  ⚠️  "+r.name+"\n")}function errorMessage(e,r){e.write("  💥  "+r.name+"\n")}function formatExtractorResults(e,r){e.write("\n"+chalk.yellow("🔍 TechCheck Scan: Making sure you're all set up 🔎")+"\n"),e.write(" ------------------------------------------------\n"),r.forEach(function(r){r.status===EvaluatorStatus.Ok&&successMessage(e,r),r.status===EvaluatorStatus.Error&&errorMessage(e,r),r.status===EvaluatorStatus.Warning&&warnMessage(e,r),r.status===EvaluatorStatus.Fail&&failMessage(e,r)})}function formatMatcher(e){if("string"==typeof e)return"= "+chalk.yellow('"'+e+'"');if(e instanceof RegExp)return"~ "+chalk.magenta("/"+e.source+"/");if(e instanceof Function)return chalk.cyan(""+e.toString());if(e.semver){var r=e.semver;if("string"==typeof r)return chalk.green(""+r);if(r.range)return chalk.green(""+r.range);if(r.min&&r.max)return chalk.green(">= "+r.min+" && <= "+r.max);if(r.min)return chalk.green(">= "+r.min);if(r.max)return chalk.green("<= "+r.max)}}function coreSetup(){return __awaiter(this,void 0,void 0,function(){var e,r,t;return __generator(this,function(n){switch(n.label){case 0:e=new ExtractorRegistry,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.setup()];case 2:return n.sent(),[2,{registry:e}];case 3:throw r=n.sent(),(t=r).message=indentError("Unable to setup extractor registry","  ",t.message),t;case 4:return[2]}})})}function projectSetup(){return __awaiter(this,void 0,void 0,function(){var e,r;return __generator(this,function(t){switch(t.label){case 0:e=new ProjectConfig,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,e.setup()];case 2:return t.sent(),[3,4];case 3:throw(r=t.sent())instanceof Error?(r.message=indentError("Unable to setup project config","  ",r.message),r):r;case 4:return[2,{config:e}]}})})}function main(){return __awaiter(this,void 0,void 0,function(){var e,r,t,n;return __generator(this,function(o){switch(o.label){case 0:return e=new Environment,[4,coreSetup()];case 1:return r=o.sent().registry,[4,projectSetup()];case 2:return t=o.sent().config,[4,new Evaluator({env:e,registry:r,config:t}).processVerifications()];case 3:return n=o.sent(),formatExtractorResults(process.stdout,n),[2,n.reduce(function(e,r){return e?[EvaluatorStatus.Ok,EvaluatorStatus.Warning].indexOf(r.status)>=0:e},!0)]}})})}(function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:return[4,main()];case 1:return e=r.sent(),process.exit(e?0:1),[2]}})})})().catch(function(e){if(e instanceof Error){var r=""+e;e instanceof Error&&e.stack&&(r=e.stack),r=r.split("\n").map(function(e){return chalk.red(e)}).join("\n"),console.error(chalk.red(r))}});
//# sourceMappingURL=index.js.map
